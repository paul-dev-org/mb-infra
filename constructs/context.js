"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Context = void 0;
const constructs_1 = require("constructs");
const fp_1 = require("../utils/fp");
const files_1 = require("../conts/files");
const config_ops_1 = require("../utils/config-ops");
class Context extends constructs_1.Construct {
    constructor(scope, id) {
        super(scope, id);
        const config = (0, fp_1.pipe)(`${process.cwd()}/${files_1.FILES.INFRA_CONFIG}`, config_ops_1.checkIfConfigFileExists, config_ops_1.readConfigFile);
        this.stage = this.node.tryGetContext("stage");
        const env = config.project.stages[this.stage];
        if (!env?.account) {
            throw new Error(`Stage ${this.stage} not found in infra.config.ts`);
        }
        this.env = {
            account: env?.account,
            region: env?.region,
            stage: this.stage,
        };
        this.config = config;
    }
}
exports.Context = Context;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvbnRleHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQXVDO0FBQ3ZDLG9DQUFtQztBQUVuQywwQ0FBdUM7QUFDdkMsb0RBQThFO0FBSTlFLE1BQWEsT0FBUSxTQUFRLHNCQUFTO0lBS2xDLFlBQVksS0FBZ0IsRUFBRSxFQUFVO1FBQ3BDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxNQUFNLEdBQUcsSUFBQSxTQUFJLEVBQ2YsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksYUFBSyxDQUFDLFlBQVksRUFBRSxFQUN4QyxvQ0FBdUIsRUFDdkIsMkJBQWMsQ0FDakIsQ0FBQztRQUNGLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFjLENBQUM7UUFFM0QsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTlDLElBQUksQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLENBQUM7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxTQUFTLElBQUksQ0FBQyxLQUFLLCtCQUErQixDQUFDLENBQUM7UUFDeEUsQ0FBQztRQUVELElBQUksQ0FBQyxHQUFHLEdBQUc7WUFDUCxPQUFPLEVBQUUsR0FBRyxFQUFFLE9BQU87WUFDckIsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNO1lBQ25CLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztTQUNwQixDQUFDO1FBRUYsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDekIsQ0FBQztDQUNKO0FBNUJELDBCQTRCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgeyBwaXBlIH0gZnJvbSBcIi4uL3V0aWxzL2ZwXCI7XG5pbXBvcnQgeyBJbmZyYUNvbmZpZyB9IGZyb20gXCIuLi9zY2hlbWFzL2luZnJhLmNvbmZpZ1wiO1xuaW1wb3J0IHsgRklMRVMgfSBmcm9tIFwiLi4vY29udHMvZmlsZXNcIjtcbmltcG9ydCB7IGNoZWNrSWZDb25maWdGaWxlRXhpc3RzLCByZWFkQ29uZmlnRmlsZSB9IGZyb20gXCIuLi91dGlscy9jb25maWctb3BzXCI7XG5cbnR5cGUgc3RhZ2VUeXBlID0gXCJkZXZcIiB8IFwic3RnXCIgfCBcInByZFwiIHwgXCJxYVwiO1xuXG5leHBvcnQgY2xhc3MgQ29udGV4dCBleHRlbmRzIENvbnN0cnVjdCB7XG4gICAgcHVibGljIHJlYWRvbmx5IHN0YWdlOiBzdGFnZVR5cGU7XG4gICAgcHVibGljIHJlYWRvbmx5IGNvbmZpZzogSW5mcmFDb25maWc7XG4gICAgcHVibGljIHJlYWRvbmx5IGVudjogeyBhY2NvdW50OiBzdHJpbmc7IHJlZ2lvbjogc3RyaW5nOyBzdGFnZTogc3RhZ2VUeXBlIH07XG5cbiAgICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHBpcGU8c3RyaW5nLCBJbmZyYUNvbmZpZz4oXG4gICAgICAgICAgICBgJHtwcm9jZXNzLmN3ZCgpfS8ke0ZJTEVTLklORlJBX0NPTkZJR31gLFxuICAgICAgICAgICAgY2hlY2tJZkNvbmZpZ0ZpbGVFeGlzdHMsXG4gICAgICAgICAgICByZWFkQ29uZmlnRmlsZVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnN0YWdlID0gdGhpcy5ub2RlLnRyeUdldENvbnRleHQoXCJzdGFnZVwiKSBhcyBzdGFnZVR5cGU7XG5cbiAgICAgICAgY29uc3QgZW52ID0gY29uZmlnLnByb2plY3Quc3RhZ2VzW3RoaXMuc3RhZ2VdO1xuXG4gICAgICAgIGlmICghZW52Py5hY2NvdW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFN0YWdlICR7dGhpcy5zdGFnZX0gbm90IGZvdW5kIGluIGluZnJhLmNvbmZpZy50c2ApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbnYgPSB7XG4gICAgICAgICAgICBhY2NvdW50OiBlbnY/LmFjY291bnQsXG4gICAgICAgICAgICByZWdpb246IGVudj8ucmVnaW9uLFxuICAgICAgICAgICAgc3RhZ2U6IHRoaXMuc3RhZ2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgfVxufVxuIl19