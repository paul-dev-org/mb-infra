#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const fs = require("fs");
const fp_1 = require("../utils/fp");
const files_1 = require("../conts/files");
const config_ops_1 = require("../utils/config-ops");
const createWorkflows = () => {
    const workflowsPath = ".github/workflows";
    if (!fs.existsSync(workflowsPath)) {
        fs.mkdirSync(workflowsPath, { recursive: true });
        console.log("Workflows directory created");
    }
    else {
        console.log(`Workflows directory already exists`);
    }
    const config = (0, fp_1.pipe)(`${process.cwd()}/${files_1.FILES.INFRA_CONFIG}`, config_ops_1.checkIfConfigFileExists, config_ops_1.readConfigFile);
    const { apps } = (0, fp_1.pipe)(`${process.cwd()}/${files_1.FILES.INFRA_CONFIG}`, config_ops_1.checkIfConfigFileExists, config_ops_1.readConfigFile);
    const serviceA = apps[0];
    const serviceB = apps[1];
    const releasePleaseTemplate = fs.readFileSync(path.resolve(__dirname, "release-please.yaml"), "utf8");
    const findReg = new RegExp("{{service_a}}", "g");
    const replacedA = releasePleaseTemplate.replace(findReg, serviceA.name);
    const findRegB = new RegExp("{{service_b}}", "g");
    const relFinal = replacedA.replace(findRegB, serviceB.name);
    const deployTemplate = fs.readFileSync(path.resolve(__dirname, "deploy.yaml"), "utf8");
    const replacedDeployA = deployTemplate.replace(findReg, serviceA.name);
    const replacedDeployB = replacedDeployA.replace(findRegB, serviceB.name);
    fs.writeFileSync(path.resolve(workflowsPath, "release-please.yaml"), relFinal);
    fs.writeFileSync(path.resolve(workflowsPath, "deploy.yaml"), replacedDeployB);
    console.log("\x1b[43m\x1b[30m%s\x1b[0m", "IMPORTANT");
    console.log("\x1b[43m\x1b[30m%s\x1b[0m", "Make sure to create environment stg and prd in the github repository settings");
    console.log("\x1b[43m\x1b[30m%s\x1b[0m", "Add people to the environment protection rules");
};
createWorkflows();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2Zsb3ctaW5pdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndvcmtmbG93LWluaXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBRUEsNkJBQTZCO0FBQzdCLHlCQUF5QjtBQUN6QixvQ0FBbUM7QUFFbkMsMENBQXVDO0FBQ3ZDLG9EQUE4RTtBQUU5RSxNQUFNLGVBQWUsR0FBRyxHQUFHLEVBQUU7SUFDekIsTUFBTSxhQUFhLEdBQUcsbUJBQW1CLENBQUM7SUFDMUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztRQUNoQyxFQUFFLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztJQUMvQyxDQUFDO1NBQU0sQ0FBQztRQUNKLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0NBQW9DLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBQ0QsTUFBTSxNQUFNLEdBQUcsSUFBQSxTQUFJLEVBQ2YsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksYUFBSyxDQUFDLFlBQVksRUFBRSxFQUN4QyxvQ0FBdUIsRUFDdkIsMkJBQWMsQ0FDakIsQ0FBQztJQUVGLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFBLFNBQUksRUFDakIsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksYUFBSyxDQUFDLFlBQVksRUFBRSxFQUN4QyxvQ0FBdUIsRUFDdkIsMkJBQWMsQ0FDakIsQ0FBQztJQUVGLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFekIsTUFBTSxxQkFBcUIsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLHFCQUFxQixDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEcsTUFBTSxPQUFPLEdBQUcsSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2pELE1BQU0sU0FBUyxHQUFHLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hFLE1BQU0sUUFBUSxHQUFHLElBQUksTUFBTSxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNsRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFNUQsTUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN2RixNQUFNLGVBQWUsR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkUsTUFBTSxlQUFlLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXpFLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUscUJBQXFCLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMvRSxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLGFBQWEsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBRTlFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDdEQsT0FBTyxDQUFDLEdBQUcsQ0FDUCwyQkFBMkIsRUFDM0IsK0VBQStFLENBQ2xGLENBQUM7SUFDRixPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLGdEQUFnRCxDQUFDLENBQUM7QUFDL0YsQ0FBQyxDQUFDO0FBRUYsZUFBZSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5cbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHsgcGlwZSB9IGZyb20gXCIuLi91dGlscy9mcFwiO1xuaW1wb3J0IHsgSW5mcmFDb25maWcgfSBmcm9tIFwiLi4vc2NoZW1hcy9pbmZyYS5jb25maWdcIjtcbmltcG9ydCB7IEZJTEVTIH0gZnJvbSBcIi4uL2NvbnRzL2ZpbGVzXCI7XG5pbXBvcnQgeyBjaGVja0lmQ29uZmlnRmlsZUV4aXN0cywgcmVhZENvbmZpZ0ZpbGUgfSBmcm9tIFwiLi4vdXRpbHMvY29uZmlnLW9wc1wiO1xuXG5jb25zdCBjcmVhdGVXb3JrZmxvd3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgd29ya2Zsb3dzUGF0aCA9IFwiLmdpdGh1Yi93b3JrZmxvd3NcIjtcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMod29ya2Zsb3dzUGF0aCkpIHtcbiAgICAgICAgZnMubWtkaXJTeW5jKHdvcmtmbG93c1BhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICBjb25zb2xlLmxvZyhcIldvcmtmbG93cyBkaXJlY3RvcnkgY3JlYXRlZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhgV29ya2Zsb3dzIGRpcmVjdG9yeSBhbHJlYWR5IGV4aXN0c2ApO1xuICAgIH1cbiAgICBjb25zdCBjb25maWcgPSBwaXBlPHN0cmluZywgSW5mcmFDb25maWc+KFxuICAgICAgICBgJHtwcm9jZXNzLmN3ZCgpfS8ke0ZJTEVTLklORlJBX0NPTkZJR31gLFxuICAgICAgICBjaGVja0lmQ29uZmlnRmlsZUV4aXN0cyxcbiAgICAgICAgcmVhZENvbmZpZ0ZpbGVcbiAgICApO1xuXG4gICAgY29uc3QgeyBhcHBzIH0gPSBwaXBlPHN0cmluZywgSW5mcmFDb25maWc+KFxuICAgICAgICBgJHtwcm9jZXNzLmN3ZCgpfS8ke0ZJTEVTLklORlJBX0NPTkZJR31gLFxuICAgICAgICBjaGVja0lmQ29uZmlnRmlsZUV4aXN0cyxcbiAgICAgICAgcmVhZENvbmZpZ0ZpbGVcbiAgICApO1xuXG4gICAgY29uc3Qgc2VydmljZUEgPSBhcHBzWzBdO1xuICAgIGNvbnN0IHNlcnZpY2VCID0gYXBwc1sxXTtcblxuICAgIGNvbnN0IHJlbGVhc2VQbGVhc2VUZW1wbGF0ZSA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcInJlbGVhc2UtcGxlYXNlLnlhbWxcIiksIFwidXRmOFwiKTtcbiAgICBjb25zdCBmaW5kUmVnID0gbmV3IFJlZ0V4cChcInt7c2VydmljZV9hfX1cIiwgXCJnXCIpO1xuICAgIGNvbnN0IHJlcGxhY2VkQSA9IHJlbGVhc2VQbGVhc2VUZW1wbGF0ZS5yZXBsYWNlKGZpbmRSZWcsIHNlcnZpY2VBLm5hbWUpO1xuICAgIGNvbnN0IGZpbmRSZWdCID0gbmV3IFJlZ0V4cChcInt7c2VydmljZV9ifX1cIiwgXCJnXCIpO1xuICAgIGNvbnN0IHJlbEZpbmFsID0gcmVwbGFjZWRBLnJlcGxhY2UoZmluZFJlZ0IsIHNlcnZpY2VCLm5hbWUpO1xuXG4gICAgY29uc3QgZGVwbG95VGVtcGxhdGUgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCJkZXBsb3kueWFtbFwiKSwgXCJ1dGY4XCIpO1xuICAgIGNvbnN0IHJlcGxhY2VkRGVwbG95QSA9IGRlcGxveVRlbXBsYXRlLnJlcGxhY2UoZmluZFJlZywgc2VydmljZUEubmFtZSk7XG4gICAgY29uc3QgcmVwbGFjZWREZXBsb3lCID0gcmVwbGFjZWREZXBsb3lBLnJlcGxhY2UoZmluZFJlZ0IsIHNlcnZpY2VCLm5hbWUpO1xuXG4gICAgZnMud3JpdGVGaWxlU3luYyhwYXRoLnJlc29sdmUod29ya2Zsb3dzUGF0aCwgXCJyZWxlYXNlLXBsZWFzZS55YW1sXCIpLCByZWxGaW5hbCk7XG4gICAgZnMud3JpdGVGaWxlU3luYyhwYXRoLnJlc29sdmUod29ya2Zsb3dzUGF0aCwgXCJkZXBsb3kueWFtbFwiKSwgcmVwbGFjZWREZXBsb3lCKTtcblxuICAgIGNvbnNvbGUubG9nKFwiXFx4MWJbNDNtXFx4MWJbMzBtJXNcXHgxYlswbVwiLCBcIklNUE9SVEFOVFwiKTtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCJcXHgxYls0M21cXHgxYlszMG0lc1xceDFiWzBtXCIsXG4gICAgICAgIFwiTWFrZSBzdXJlIHRvIGNyZWF0ZSBlbnZpcm9ubWVudCBzdGcgYW5kIHByZCBpbiB0aGUgZ2l0aHViIHJlcG9zaXRvcnkgc2V0dGluZ3NcIlxuICAgICk7XG4gICAgY29uc29sZS5sb2coXCJcXHgxYls0M21cXHgxYlszMG0lc1xceDFiWzBtXCIsIFwiQWRkIHBlb3BsZSB0byB0aGUgZW52aXJvbm1lbnQgcHJvdGVjdGlvbiBydWxlc1wiKTtcbn07XG5cbmNyZWF0ZVdvcmtmbG93cygpO1xuIl19